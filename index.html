<html>
<script src = 'https://d3js.org/d3.v5.min.js'></script>
<body onload ='init()'>

<div id="my_dataviz"></div>
<select id="selectButton"></select>

<div>
  <input type="checkbox" class="checkbox" value="Asia" checked><label>Asia</label>
  <input type="checkbox" class="checkbox" value="Europe" checked><label>Europe</label>
  <input type="checkbox" class="checkbox" value="Africa" checked><label>Africa</label>
  <input type="checkbox" class="checkbox" value="North America" checked><label>North America</label>
 <input type="checkbox" class="checkbox" value="South America" checked><label>South America</label>
  <input type="checkbox" class="checkbox" value="Oceanica" checked><label>Oceanica</label>
  <input type="checkbox" class="checkbox" value="Antartica" checked><label>Antartica</label>
</div>
<script>
async function init() {

var margin = {top: 10, right: 20, bottom: 30, left: 50},
    width = 500 - margin.left - margin.right,
    height = 420 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

const data = await d3.csv("./WorldBankData.csv")

var allGroup = d3.map(data, function(d){return(d.continent)}).keys();

d3.select("#selectButton")
      .selectAll('myOptions')
     	.data(allGroup)
      .enter()
    	.append('option')
      .text(function (d) { return d; }) // text showed in the menu
      .attr("value", function (d) { return d; })


	
var x=d3.scaleLinear()
.domain([0,10000])
.range([0,width]);

svg.append("g")
.attr("transform","translate(0," + height + ")")
.call(d3.axisBottom(x));

var y = d3.scaleLinear()
.domain([35,90])
.range([height,0]);

svg.append("g")
.call(d3.axisLeft(y));

var z=d3.scaleLinear()
.domain([200000,1310000000])
.range([1,40]);


var myColor = d3.scaleOrdinal().domain(data)
  .range(d3.schemePaired);



var circle = svg.append("g")
.selectAll("dot")
.data(data)
.enter()
.append("circle")
.attr("class" , function(d){ return d.continent })
.attr("cx", function (d) {return x(d.GDPperCapita);} )
.attr("cy", function (d) {return y(d.LifeExpectancy);} )
.attr("r", function (d) {return z(d.TotalPopulation);} )
.style("fill", function(d) {return myColor(d.continent);})
.style("opacity", "0.7")
.attr("stroke", "black")
.append('title')
.text(d => d.country)
.on('mouseover', function() {
     d3.select(this).attr('stroke', '#333').attr('stroke-width', 2);
    })
    .on('mouseout', function() {
         d3.select(this).attr('stroke', null);})

 function update(){

      // For each check box:
      d3.selectAll(".checkbox").each(function(d){
        cb = d3.select(this);
        grp = cb.property("value")

        // If the box is check, I show the group
        if(cb.property("checked")){
          svg.selectAll("."+grp).transition().duration(1000).style("opacity", 1).attr("r", function(d){ return z(d.TotalPopulation) })

        // Otherwise I hide it
        }else{
          svg.selectAll("."+grp).transition().duration(1000).style("opacity", 0).attr("r", 0)
        }
      })
    }

    // When a button change, I run the update function
    d3.selectAll(".checkbox").on("change",update);

    // And I initialize it at the beginning
    update()



}
</script>
</body>
</html>
